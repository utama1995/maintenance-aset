<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel - Maintenance Aset</title>

<style>

body{
margin:0;
font-family:Arial,Helvetica,sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
}

.container{
width:95%;
max-width:1200px;
margin:30px auto;
background:white;
border-radius:10px;
box-shadow:0 10px 25px rgba(0,0,0,0.3);
overflow:hidden;
}

.header{
display:flex;
justify-content:space-between;
align-items:center;
padding:15px 20px;
background:#2c5364;
color:white;
}

.logout-btn{
background:#e74c3c;
border:none;
padding:8px 15px;
color:white;
border-radius:6px;
cursor:pointer;
}

.content{
padding:20px;
}

table{
width:100%;
border-collapse:collapse;
}

th{
background:#2c5364;
color:white;
padding:10px;
}

td{
padding:10px;
border-bottom:1px solid #ddd;
}

tr:hover{
background:#f2f2f2;
}

button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
background:#2c5364;
color:white;
}

.status{
padding:4px 8px;
border-radius:4px;
color:white;
font-size:12px;
}

.waiting{background:#f39c12;}
.process{background:#3498db;}
.done{background:#27ae60;}

.modal{
display:none;
position:fixed;
left:0;
top:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.5);
}

.modal-content{
background:white;
width:400px;
margin:8% auto;
padding:20px;
border-radius:10px;
}

.modal-content input,
.modal-content textarea,
.modal-content select{
width:100%;
padding:8px;
margin-bottom:10px;
}

.save-btn{
background:#27ae60;
}

.cancel-btn{
background:#999;
}

.footer{
text-align:center;
padding:15px;
font-size:12px;
color:#777;
}

</style>

</head>
<body>

<script>
const token = localStorage.getItem("token");

if(!token){
alert("Silakan login terlebih dahulu");
window.location.href="login.html";
}
</script>

<div class="container">

<div class="header">
<h2>Admin Panel - Maintenance Aset</h2>
<button class="logout-btn" onclick="logout()">Logout</button>
</div>

<div class="content">

<h3>Daftar Laporan</h3>

<table id="tabel">

<thead>
<tr>
<th>Ticket ID</th>
<th>Pelapor</th>
<th>Aset</th>
<th>Deskripsi</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>

<tbody>
<tr>
<td colspan="6">Memuat data...</td>
</tr>
</tbody>

</table>

</div>

<div class="footer">
Maintenance Asset Management System
</div>

</div>


<!-- MODAL -->
<div id="editModal" class="modal">

<div class="modal-content">

<h3>Edit Ticket</h3>

<label>Ticket ID</label>
<input id="edit_ticket" readonly>

<label>Status</label>
<select id="edit_status">
<option value="Waiting">Waiting</option>
<option value="On Progress">On Progress</option>
<option value="Done">Done</option>
</select>

<label>Catatan GA</label>
<textarea id="edit_catatan"></textarea>

<label>Vendor</label>
<input id="edit_vendor">

<button class="save-btn" onclick="saveEdit()">Save</button>
<button class="cancel-btn" onclick="closeModal()">Cancel</button>

</div>

</div>


<script>

const API_URL="https://script.google.com/macros/s/AKfycbwAuwcAOQhi7q90-kVLciUIcjbeDmF6fdc17gpbwXe8ZXfU6L6npyfBbkR_YidGFLDtCA/exec";


function logout(){
localStorage.removeItem("token");
window.location.href="login.html";
}


async function loadData(){

const tbody=document.querySelector("#tabel tbody");

tbody.innerHTML="<tr><td colspan='6'>Loading...</td></tr>";

try{

const res=await fetch(API_URL+"?action=list");

const data=await res.json();

tbody.innerHTML="";

data.forEach(row=>{

const ticketId=row.id || "-";
const nama=row.nama || "-";
const aset=row.aset || "-";
const deskripsi=row.deskripsi || "-";
const status=row.status || "Waiting";

let statusClass="waiting";

if(status==="On Progress")statusClass="process";
if(status==="Done")statusClass="done";

tbody.innerHTML+=`
<tr>

<td>${ticketId}</td>
<td>${nama}</td>
<td>${aset}</td>
<td>${deskripsi}</td>

<td>
<span class="status ${statusClass}">
${status}
</span>
</td>

<td>
<button onclick="openEditModal('${ticketId}','${status}')">
Edit
</button>
</td>

</tr>
`;

});

}catch(err){

tbody.innerHTML="<tr><td colspan='6'>Gagal memuat data</td></tr>";

}

}


function openEditModal(ticket,status){

document.getElementById("edit_ticket").value=ticket;
document.getElementById("edit_status").value=status;

document.getElementById("edit_catatan").value="";
document.getElementById("edit_vendor").value="";

document.getElementById("editModal").style.display="block";

}


function closeModal(){

document.getElementById("editModal").style.display="none";

}


async function saveEdit(){

const ticket_id=document.getElementById("edit_ticket").value;
const status=document.getElementById("edit_status").value;
const catatan=document.getElementById("edit_catatan").value;
const vendor=document.getElementById("edit_vendor").value;


try{

const res=await fetch(API_URL,{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

action:"updateTicket",
ticket_id:ticket_id,
status:status,
catatan:catatan,
vendor:vendor,
estimasi:""

})

});

const result=await res.json();

if(result.success){

alert("Berhasil update");

closeModal();

loadData();

}else{

alert("Update gagal");

}

}catch(err){

alert("Error koneksi");

}

}


loadData();

</script>

</body>
</html>
